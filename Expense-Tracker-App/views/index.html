<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Expense Manager</title>
    <style>
        body {
            font-family: Arial;
            margin: 30px;
            padding: 0;
        }
        .container { max-width: 600px; margin: auto; }
        input, select {
            width: 100%; padding: 10px; margin: 10px 0;
        }
        button {
            padding: 10px 15px;
            margin-right: 10px;
            cursor: pointer;
        }
        .expense-item {
            padding: 10px;
            border: 1px solid gray;
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Expense Tracker</h1>

    <form id="expenseForm">
        <input type="text" id="title" placeholder="Title" required />
        <input type="number" id="amount" placeholder="Amount" required />
        <input type="text" id="category" placeholder="Category" />
        <input type="date" id="date" />

        <button type="submit" id="submitBtn">Add Expense</button>
    </form>

    <h2>Expenses</h2>
    <div id="expenseList"></div>
</div>

<script>
    const API_URL = "http://localhost:4000/expenses";
    let editingId = null;

    // Load All Expenses From DB
    async function loadExpenses() {
        const res = await fetch(API_URL);
        const expenses = await res.json();

        const list = document.getElementById("expenseList");
        list.innerHTML = "";

        expenses.forEach(exp => {
            const div = document.createElement("div");
            div.className = "expense-item";

            div.innerHTML = `
                <div>
                    <strong>${exp.title}</strong>  
                    ₹${exp.amount} — ${exp.category}  
                    (${exp.date})
                </div>
                <div>
                    <button onclick="editExpense(${exp.id}, '${exp.title}', ${exp.amount}, '${exp.category}', '${exp.date}')">Edit</button>
                    <button onclick="deleteExpense(${exp.id})">Delete</button>
                </div>
            `;

            list.appendChild(div);
        });
    }

    // Add or Update Expense
    document.getElementById("expenseForm").addEventListener("submit", async (e) => {
        e.preventDefault();

        const data = {
            title: document.getElementById("title").value,
            amount: document.getElementById("amount").value,
            category: document.getElementById("category").value,
            date: document.getElementById("date").value
        };

        if (editingId === null) {
            // Create
            await fetch(API_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });
        } else {
            // Update
            await fetch(`${API_URL}/${editingId}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });

            editingId = null;
            document.getElementById("submitBtn").innerText = "Add Expense";
        }

        loadExpenses();
        e.target.reset();
    });

    // Delete Expense
    async function deleteExpense(id) {
        await fetch(`${API_URL}/${id}`, { method: "DELETE" });
        loadExpenses();
    }

    // Edit Expense → populate form
    function editExpense(id, title, amount, category, date) {
        editingId = id;
        document.getElementById("title").value = title;
        document.getElementById("amount").value = amount;
        document.getElementById("category").value = category;
        document.getElementById("date").value = date;

        document.getElementById("submitBtn").innerText = "Update Expense";
    }

    // Load expenses on page open
    loadExpenses();
</script>

</body>
</html>
